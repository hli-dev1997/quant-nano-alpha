# **    A股市场九转序列（TD Sequential）高级量化策略最终报告**

---

## **摘要**
本报告旨在系统性地阐述汤姆·德马克（TD Sequential）九转序列量化策略，并完成其在A股市场的高级本地化改造。报告深入剖析了策略的数学内核，针对A股特有的交易制度、数据结构和市场行为进行了关键性适配，并构建了完整的量化回测与风险管理框架。核心结论表明，经过严谨修正的九转序列策略，在A股市场能有效识别趋势衰竭点，但必须与严格的止损纪律、仓位管理及市场环境判断相结合，方能获取稳健的超额收益。

---

## **1. 策略哲学：趋势衰竭的量化度量**
TD Sequential的核心思想并非预测，而是**度量**。它基于市场动力学中的“边际效用递减”原理：任何趋势的延续都需要更多资金和情绪推动，其动能必将呈现非线性衰减。该策略通过一系列严格的数学不等式，将这种抽象的“衰竭”概念转化为可计量的价格序列事件，从而在趋势反转的临界区域发出信号。

在**散户化特征明显、政策驱动性强、存在涨跌停限制**的A股市场，情绪和资金的极端化往往导致价格过度延伸，这为均值回归类的衰竭策略提供了高盈亏比的潜在机会。

## **2. 核心数学定义：从Setup到Countdown的严谨构建**
本节采用数学语言严格定义策略规则，消除歧义。

### **2.1 启动阶段（TD Setup）**
*   **价格反转（Price Flip）**：启动Setup的必要前置条件。
    *   **看跌价格反转**（启动买入Setup）：`Close_{t-1} > Close_{t-5}` 且 `Close_{t} < Close_{t-4}`
    *   **看涨价格反转**（启动卖出Setup）：`Close_{t-1} < Close_{t-5}` 且 `Close_{t} > Close_{t-4}`
*   **Setup计数规则**：
    *   **买入Setup**：连续满足 `Close_{i} < Close_{i-4}` 的K线数量达到9。 (**建议使用严格小于**，以过滤A股常见的横盘震荡噪音)
    *   **卖出Setup**：连续满足 `Close_{i} > Close_{i-4}` 的K线数量达到9。
*   **完善机制（Perfection）**：Setup计数到9时，必须通过此过滤器才能被视为有效。
    *   **买入Setup完善**：`min(Low_8, Low_9) <= min(Low_6, Low_7)`
    *   **卖出Setup完善**：`max(High_8, High_9) >= max(High_6, High_7)`
    *   *未完善的Setup信号较弱，通常应忽略或等待价格突破后再行确认。*

### **2.2 计数阶段（TD Countdown）**
*   **起始条件**：在一个“完善的”Setup完成后立即开始。
*   **计数规则**：
    *   **买入Countdown**：每当 `Close_{j} <= Low_{j-2}` 时，计数加1（累计13次，可非连续）。
    *   **卖出Countdown**：每当 `Close_{j} >= High_{j-2}` 时，计数加1（累计13次，可非连续）。
*   **最终确认（Qualifier）**：
    *   **买入计数13确认**：`Low_{13} <= Close_{Count8}`
    *   **卖出计数13确认**：`High_{13} >= Close_{Count8}`
    *   *若第13根K线不满足条件，则标签“13”被推迟，直至满足条件的K线出现。*

## **3. A股市场关键适配与修正**
### **3.1 视觉与认知适配（红绿悖论）**
*   **国际惯例**：绿涨红跌，高9（卖）标绿，低9（买）标红。
*   **A股修正惯例**：红涨绿跌。为符合本土交易员直觉，必须在可视化时进行反转：
    *   **低9（买入信号）**：在K线下方标记为**红色**数字“9”。
    *   **高9（卖出信号）**：在K线上方标记为**绿色**数字“9”。

### **3.2 交易制度适配**
*   **涨跌停板过滤**：
    *   若计数第9根K线或第13根K线处于**涨/跌停板**状态，则该信号视为**无效**或**推迟**。因流动性枯竭，价格未能真实反映市场供求关系。
    *   **ST股票（5%涨跌幅）** 极易产生无效信号，建议在初始股票池中直接剔除。
*   **数据清洗**：
    *   必须使用**后复权**价格序列进行计算，避免除权缺口干扰。
    *   信号确认应以**交易日15:00收盘价**为准，规避尾盘集合竞价阶段的异常波动风险。

## **4. 状态机管理：策略逻辑的核心**
正确的状态管理是策略代码正确与否的关键。

| 状态 | 触发条件 | 结果与行动 |
| :--- | :--- | :--- |
| **中断 (Interruption)** | 在Setup计数（1-8）过程中，出现一根不满足Setup不等式的K线。 | **Setup计数立即归零**。等待新的价格反转信号重新开始。 |
| **取消 (Cancellation)** | 在Countdown计数（1-12）过程中，发生以下任一事件：<br>1. 价格突破**TDST防线**（买入Countdown中，收盘价>买入Setup第一根K线最高价）。<br>2. 生成了一个完整的、方向相反的**新Setup**。 | **当前整个Countdown过程被永久取消**。市场逻辑已变，需重新寻找起点。 |
| **循环 (Recycling)** | 在一个Setup完成后，市场未反转，随即产生第二个同向Setup，且其价格波动幅度显著大于第一个。 | **第一个Setup被覆盖/忽略**，以第二个更强烈的Setup作为新基准。量化标准：`Range_{Setup2} >= 1.618 * Range_{Setup1}` |

## **5. 量化回测体系与风险管理**
### **5.1 回测框架构建要点**
1.  **数据**：沪深300、中证1000成分股，2015年至今，日频后复权数据。
2.  **信号逻辑**：严格按上述数学定义及状态机编码。
3.  **交易逻辑**：
    *   **入场**：完善的“低9”可作为观察仓或首次入场点；“低13”是更强的入场信号。
    *   **止损**：**TDST防线是生命线**。买入后，若收盘价跌破对应买入Setup第一根K线的最低价，应坚决止损。
    *   **止盈**：可结合反向九转信号、重要阻力位或固定风险收益比（如2:1）出场。

### **5.2 核心绩效评估指标**
*   **卡玛比率（Calmar Ratio）** > 1.5，表明策略在承担单位回撤下获取收益的能力较强。
*   **最大回撤（Max Drawdown）** < 20%，确保策略在极端行情下的生存能力。
*   **胜率分布**：重点考察信号发出后10日、20日的胜率及盈亏比，区分震荡市与趋势市的表现。

### **5.3 进阶仓位管理（金字塔模型）**
为降低左侧交易风险，推荐采用分步建仓：
1.  **底仓（30%）**：在出现“完善的买入Setup 9”时建立。
2.  **加仓（30%）**：在“买入Countdown 13”确认时加仓。
3.  **确认仓（40%）**：当价格有效突破并站稳**TDST阻力线**（前期Setup第一根K线最高价）时，确认趋势反转，投入剩余仓位。

## **6. 第二层思维：超越指标本身**
### **6.1 市场博弈与“信号猎杀”**
由于九转序列在散户中普及，需警惕以下博弈行为：
*   **自我实现**：核心资产出现“低9”时，集体买入行为会形成短期支撑。
*   **机构猎杀**：主力资金可能故意砸穿“低9”低点，触发散户集中止损后反向拉升。
*   **应对**：不在“9”当日收盘机械入场，可观察后续1-2根K线，出现**放量下影线**或**阳包阴**等确认结构后再行动。

### **6.2 宏观与政策共振**
九转序列的效力与市场环境高度相关：
*   **高胜率环境**：震荡市、政策底区域（如降准、重要会议维稳期），技术衰竭与政策暖意共振。
*   **低效/危险环境**：单边暴涨/暴跌市（如杠杆牛、股灾）、受突发重大基本面驱动的板块（如题材爆炒的科创板）。此时需结合趋势型指标进行过滤。

### **6.3 行业特性分析**
*   **适用性强**：银行、公用事业、消费白马等波动率低、均值回归属性强的行业。
*   **适用性弱**：科技成长、概念主题、微盘股等趋势惯性大、受情绪驱动强烈的板块。在这些板块中，九转序列仅可作为**趋势减弱的预警**，而非反向操作的铁律。

## **7. 结论**
经过深度适配的九转序列策略，是一把精准测量A股市场情绪“体温”的量化尺规。其价值不在于提供“圣杯”，而在于提供一套**高度纪律化、系统化的反转交易框架**。

**成功应用本策略的三重基石：**
1.  **规则的纯粹性**：坚守数学定义的严谨性，避免主观臆改。
2.  **市场的敬畏心**：深刻理解A股微观结构，做好涨跌停过滤与流动性管理。
3.  **系统的纪律性**：无条件执行TDST止损，并采用金字塔仓位管理控制风险。

最终，该策略应与市场环境判断、资金流向分析乃至宏观情绪指标相结合，从独立的“指标”进化为综合“交易系统”中的关键组件，方能在复杂多变的A股市场中行稳致远。

---
**附录：核心参数速查表**
| 组件 | 数学定义 | A股特别注意 |
| :--- | :--- | :--- |
| **买入Setup** | `Close_t < Close_{t-4}` (连续9日) | 用严格<，防横盘假信号；跌停日无效 |
| **卖出Setup** | `Close_t > Close_{t-4}` (连续9日) | 用严格>，防横盘假信号；涨停日无效 |
| **买入Countdown** | `Close_t <= Low_{t-2}` (累计13次) | 非连续计数；第13根需满足Low<=Close_8 |
| **TDST买入止损** | 买入Setup第一根K线的最低价 | 收盘价跌破此线，无条件止损 |
| **可视化颜色** | 低9标红，高9标绿 | 适配“红涨绿跌”文化认知 |