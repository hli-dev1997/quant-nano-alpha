# 量化选股系统 - 面试指南

> 本文档帮助你在 **京东、蚂蚁、字节** 等互联网大厂面试中，用这个项目展现技术深度。

---

## 🏗️ 项目架构概览

```
┌─────────────────────────────────────────────────────────────────────┐
│                        quant-nano-alpha 全链路                       │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌──────────────┐    Kafka     ┌──────────────┐                    │
│  │ Data         │─────────────>│ Strategy     │                    │
│  │ Collector    │  quotation   │ Engine       │                    │
│  │ (行情采集)    │              │ (策略引擎)    │                    │
│  └──────────────┘              └──────┬───────┘                    │
│         │                             │                            │
│         │ quotation-index             │ strategy-signal            │
│         ▼                             ▼                            │
│  ┌──────────────┐              ┌──────────────┐                    │
│  │ Risk         │◄────Redis────│ Signal       │                    │
│  │ Control      │  sentiment   │ Center       │                    │
│  │ (风控模块)    │              │ (信号中心)    │                    │
│  └──────────────┘              └──────┬───────┘                    │
│                                       │                            │
│                                       ▼                            │
│                                ┌──────────────┐                    │
│                                │   MySQL      │                    │
│                                │ (信号落库)    │                    │
│                                └──────────────┘                    │
│                                                                    │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 📊 核心技术亮点

| 技术点 | 项目应用 | 面试深度问题 |
|--------|----------|--------------|
| **Kafka** | 行情数据异步传输，策略信号解耦 | 分区策略、消费者组重平衡、Exactly-Once 语义 |
| **Redis** | 实时风控分数存储，信号缓存 | 缓存穿透/击穿/雪崩、分布式锁、过期策略 |
| **MySQL** | 信号持久化，幂等写入 | 索引优化、ON DUPLICATE KEY UPDATE 原理 |
| **分布式追踪** | traceId 全链路透传 | 如何实现跨服务追踪、Sleuth/SkyWalking 对比 |
| **策略模式** | BaseStrategy 抽象设计 | 设计模式实战、开闭原则体现 |
| **风控系统** | 市场情绪评分 + 信号拦截 | 一致性保证、降级方案、熔断机制 |

---

## 🎤 面试话术模板

### 问题1：讲讲你做过的最有技术挑战的项目？

> "我独立设计并实现了一个 **量化选股分布式微服务系统**，支持 **万级股票并发处理**，日均处理 **百万级行情数据**。
> 
> 核心架构是：数据采集 → Kafka → 策略引擎 → 风控过滤 → 信号落库。
> 
> 技术亮点包括：
> 1. **Kafka** 实现行情数据的异步解耦，QPS 达到 XXX
> 2. **Redis** 实时存储市场情绪分数，读取延迟 < 2ms
> 3. **全链路 traceId** 追踪，从数据采集到信号落库可视化排查
> 4. **ON DUPLICATE KEY UPDATE** 保证信号幂等写入
>
> 遇到的最大挑战是 Kafka 消费者调试断点导致的 Rebalance 问题，通过调整 `max.poll.interval.ms` 解决。"

### 问题2：Kafka 消费者重平衡是怎么回事？

> "当消费者长时间不调用 `poll()` 超过 `max.poll.interval.ms`（默认5分钟），Kafka Broker 会认为该消费者已死，触发重平衡。
>
> 在我的项目中，调试断点时就遇到了这个问题，解决方案：
> 1. 开发环境调大 `max.poll.interval.ms`
> 2. 生产环境合理设置 `max.poll.records` 控制批量大小
> 3. 保证消费逻辑尽量轻量，避免长时间阻塞"

### 问题3：如何保证信号不重复入库？

> "使用 MySQL 的 `INSERT ... ON DUPLICATE KEY UPDATE` 语法，利用唯一索引 `(wind_code, strategy_id, signal_time)` 实现幂等。
>
> 当 Kafka 消息重复消费时，数据库层面自动去重，只更新 `trigger_price`、`risk_snapshot` 等字段。"

### 问题4：风控系统是如何设计的？

> "风控模块订阅指数行情 Kafka Topic，实时计算 11 个核心指数的涨跌幅，加权求和得到市场情绪分数（0-100）。
>
> 分数每秒推送到 Redis，信号中心在处理每个策略信号时，先读取 Redis 分数：
> - 分数 < 50：拦截信号（showStatus=0）
> - 分数 >= 50：放行信号（showStatus=1）
>
> 这样实现了策略信号与风控逻辑的解耦。"

---

## 📈 性能指标（压测后补充）

| 指标 | 目标值 | 实测值 | 备注 |
|------|--------|--------|------|
| **行情处理 QPS** | 10,000+ | _待测_ | 万级股票并发 |
| **信号落库 TPS** | 1,000+ | _待测_ | 含风控查询 |
| **Redis 读取延迟** | < 5ms | ~2ms | P99 |
| **Kafka 消费延迟** | < 100ms | ~20ms | 端到端 |
| **全链路延迟** | < 500ms | _待测_ | 从行情到落库 |

---

## 🔥 高频深度问题准备

### Kafka 相关
1. Kafka 如何保证消息不丢失？
2. 消费者组重平衡策略有哪些？
3. Kafka 的 Exactly-Once 语义如何实现？
4. 如何处理消费积压？

### Redis 相关
1. Redis 缓存穿透/击穿/雪崩的区别和解决方案？
2. Redis 分布式锁用什么实现？有什么坑？
3. Redis 过期策略是什么？
4. Redis 持久化方式的区别？

### MySQL 相关
1. ON DUPLICATE KEY UPDATE 的原理？
2. 如何优化慢 SQL？
3. InnoDB 索引结构是什么？
4. 事务隔离级别有哪些？

### 分布式相关
1. 如何实现分布式链路追踪？
2. 微服务间的通信方式有哪些？
3. 服务降级和熔断的区别？
4. 如何保证分布式系统的幂等性？

---

## ✅ 面试前 Checklist

- [ ] 能画出完整架构图
- [ ] 能讲清楚每个模块的职责
- [ ] 能回答 Kafka/Redis/MySQL 深度问题
- [ ] 有压测数据支撑性能指标
- [ ] 准备 2-3 个遇到的问题及解决方案
- [ ] 能解释业务逻辑的合理性

---

## 📚 相关文档

- [全链路数据流文档](../architecture/FullChainDataFlow.md)
- [风控模块设计](../../services/quant-risk-control/README.md)
- [策略引擎设计](../../services/quant-strategy-engine/README.md)

---

> 💡 **记住**：能讲清楚 + 有实测数据 + 能回答深度问题 = 💪 Offer Get!
