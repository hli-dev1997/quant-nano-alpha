# é‡åŒ–äº¤æ˜“ç³»ç»Ÿé¡¹ç›®é¢è¯•è¯„ä¼°æŠ¥å‘Š

> **è¯„ä¼°è§’åº¦**ï¼šäº’è”ç½‘å¤§å‚ï¼ˆé˜¿é‡Œã€å­—èŠ‚ã€è…¾è®¯ã€ç¾å›¢ç­‰ï¼‰5å¹´å†…ç¤¾æ‹›Javaåç«¯å·¥ç¨‹å¸ˆ

---

## ğŸ“Š æ€»ä½“è¯„åˆ†ï¼š78/100 ï¼ˆå¯é€šè¿‡åˆç­›ï¼Œä¸­å¤§å‚äºŒé¢æœ‰ç«äº‰åŠ›ï¼‰

| ç»´åº¦ | å¾—åˆ† | æƒé‡ | è¯„è¯­ |
|------|------|------|------|
| æ¶æ„è®¾è®¡ | 85/100 | 25% | å¾®æœåŠ¡æ‹†åˆ†åˆç†ï¼Œè®¾è®¡æ¨¡å¼è¿ç”¨ä¸°å¯Œ |
| ä»£ç è´¨é‡ | 75/100 | 20% | æœ‰è§„èŒƒä½†éƒ¨åˆ†æ¨¡å—å¾…å®Œå–„ |
| æŠ€æœ¯æ·±åº¦ | 80/100 | 20% | æ¶µç›–é«˜å¹¶å‘ã€åˆ†å¸ƒå¼ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰æ ¸å¿ƒæŠ€æœ¯æ ˆ |
| æµ‹è¯•è¦†ç›– | 70/100 | 15% | æœ‰å•å…ƒæµ‹è¯•ä½†è¦†ç›–ç‡ä¸è¶³ |
| æ–‡æ¡£å®Œå–„ | 65/100 | 10% | éƒ¨åˆ†æ¨¡å—æ–‡æ¡£è¯¦ç»†ï¼ŒREADME ä¸ºç©º |
| äº®ç‚¹åˆ›æ–° | 80/100 | 10% | å†·çƒ­è¡¨åˆ†ç¦»ã€æ–­è·¯å™¨ã€è™šæ‹Ÿæ—¶é’Ÿç­‰äº®ç‚¹çªå‡º |

---

## âœ… é¡¹ç›®äº®ç‚¹ï¼ˆé¢è¯•åŠ åˆ†é¡¹ï¼‰

### 1. å¾®æœåŠ¡æ¶æ„è®¾è®¡ä¼˜ç§€

```
quant-nano-alpha/
â”œâ”€â”€ common                    # å…¬å…±æ¨¡å—ï¼ˆDTO/æšä¸¾/å·¥å…·ç±»ï¼‰
â”œâ”€â”€ quant-data-collector      # æ•°æ®é‡‡é›†æœåŠ¡
â”œâ”€â”€ quant-data-archive        # æ•°æ®å½’æ¡£æœåŠ¡
â”œâ”€â”€ quant-strategy-engine     # ç­–ç•¥å¼•æ“ï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€â”€ quant-risk-control        # é£æ§æœåŠ¡
â”œâ”€â”€ quant-stock-list          # è‚¡ç¥¨åˆ—è¡¨æœåŠ¡
â””â”€â”€ quant-xxl-job             # å®šæ—¶ä»»åŠ¡è°ƒåº¦
```

**é¢è¯•è¯æœ¯**ï¼š
> "æˆ‘é‡‡ç”¨é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰æ€æƒ³è¿›è¡ŒæœåŠ¡æ‹†åˆ†ï¼Œæ¯ä¸ªæœåŠ¡å•ä¸€èŒè´£ï¼Œæ¯”å¦‚æ•°æ®é‡‡é›†ä¸ç­–ç•¥è®¡ç®—å®Œå…¨è§£è€¦ï¼Œé€šè¿‡ Kafka è¿›è¡Œå¼‚æ­¥é€šä¿¡ï¼Œå®ç°äº†æ°´å¹³æ‰©å±•èƒ½åŠ›ã€‚"

### 2. è®¾è®¡æ¨¡å¼è¿ç”¨ä¸°å¯Œï¼ˆæ ¸å¿ƒåŠ åˆ†é¡¹ï¼‰

| æ¨¡å¼ | åº”ç”¨åœºæ™¯ | å®ç°ç±» |
|------|----------|--------|
| **è´£ä»»é“¾** | é£æ§æ ¡éªŒé“¾ | `StrategyChain` â†’ `AuthHandler` â†’ `RateLimitHandler` â†’ `RiskCheckHandler` |
| **å¤–è§‚** | ç»Ÿä¸€ç­–ç•¥æ‰§è¡Œå…¥å£ | `StrategyEngineFacade` |
| **è£…é¥°å™¨** | ç­–ç•¥ç¼“å­˜å¢å¼º | `CachingDecorator` |
| **æ³¨å†Œè¡¨** | ç­–ç•¥åŠ¨æ€æ³¨å†Œ | `StrategyRegistry` |
| **æ–­è·¯å™¨** | ç†”æ–­é™çº§ | `CircuitBreakerService`ï¼ˆè‡ªç ”å®ç°ï¼Œå« CLOSED/OPEN/HALF_OPEN çŠ¶æ€æœºï¼‰ |

**é¢è¯•è¯æœ¯**ï¼š
> "æˆ‘åœ¨ç­–ç•¥å¼•æ“ä¸­å®ç°äº†å®Œæ•´çš„è´£ä»»é“¾æ¨¡å¼ï¼Œå°†é£æ§æ ¡éªŒã€æƒé™éªŒè¯ã€é™æµæ‹¦æˆªç­‰å‰ç½®é€»è¾‘è§£è€¦ä¸ºç‹¬ç«‹çš„ Handlerï¼Œé€šè¿‡ `@Order` æ§åˆ¶æ‰§è¡Œé¡ºåºï¼Œæ–°å¢æ ¡éªŒé€»è¾‘åªéœ€å®ç°æ¥å£å¹¶æ³¨å†Œåˆ°å®¹å™¨å³å¯ï¼Œå®Œå…¨ç¬¦åˆå¼€é—­åŸåˆ™ã€‚"

### 3. é«˜å¹¶å‘å¤„ç†èƒ½åŠ›

- **çº¿ç¨‹æ± é…ç½®**ï¼š`ThreadPoolConfig` åŒºåˆ† CPU å¯†é›†å‹å’Œ IO å¯†é›†å‹ä»»åŠ¡
- **å¹¶è¡Œå¤„ç†**ï¼š`CompletableFuture` å®ç°å†·çƒ­è¡¨å¹¶è¡ŒæŸ¥è¯¢
- **é™æµç»„ä»¶**ï¼š`RateLimiterService` + `RateLimitMetrics`
- **åˆ†å¸ƒå¼é”**ï¼šä¿éšœç­–ç•¥æ‰§è¡Œå¹‚ç­‰æ€§

**é¢è¯•è¯æœ¯**ï¼š
> "åœ¨æ•°æ®æŸ¥è¯¢åœºæ™¯ï¼Œæˆ‘ä½¿ç”¨ `CompletableFuture.allOf()` å®ç°å†·çƒ­è¡¨å¹¶è¡ŒæŸ¥è¯¢ï¼Œç›¸æ¯”ä¸²è¡ŒæŸ¥è¯¢æ€§èƒ½æå‡çº¦ 40%ã€‚åŒæ—¶é€šè¿‡ IO çº¿ç¨‹æ± éš”ç¦»ï¼Œé¿å…æ…¢æŸ¥è¯¢é˜»å¡æ ¸å¿ƒä¸šåŠ¡çº¿ç¨‹ã€‚"

### 4. æ•°æ®åº“å†·çƒ­åˆ†ç¦»è®¾è®¡

```java
// çƒ­è¡¨ï¼š2024å¹´åŠä»¥åæ•°æ®ï¼ˆé«˜é¢‘è®¿é—®ï¼‰
private static final String TABLE_HOT = "tb_quotation_history_hot";
// æ¸©è¡¨ï¼š2024å¹´ä»¥å‰æ•°æ®ï¼ˆä½é¢‘è®¿é—®ï¼‰
private static final String TABLE_WARM = "tb_quotation_history_warm";
```

**é¢è¯•è¯æœ¯**ï¼š
> "è€ƒè™‘åˆ°è‚¡ç¥¨è¡Œæƒ…æ•°æ®é‡å·¨å¤§ï¼ˆæ¯æ—¥çº¦7200ä¸‡æ¡ï¼‰ï¼Œæˆ‘è®¾è®¡äº†å†·çƒ­è¡¨åˆ†ç¦»æ–¹æ¡ˆï¼Œå°†çƒ­æ•°æ®å­˜å‚¨åœ¨ä¸»è¡¨ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ï¼Œå†å²æ•°æ®å½’æ¡£åˆ°æ¸©è¡¨é™ä½å­˜å‚¨æˆæœ¬ï¼ŒæŸ¥è¯¢æ—¶è‡ªåŠ¨åˆ¤æ–­æ—¶é—´èŒƒå›´è·¯ç”±åˆ°å¯¹åº”è¡¨ã€‚"

### 5. è¡Œæƒ…å›æ”¾ç³»ç»Ÿè®¾è®¡ï¼ˆäº®ç‚¹ï¼ï¼‰

- **è™šæ‹Ÿæ—¶é’Ÿ**ï¼šç²¾ç¡®æ¨¡æ‹ŸçœŸå®å¸‚åœºèŠ‚å¥
- **é¢„åŠ è½½æœºåˆ¶**ï¼šç‹¬ç«‹çº¿ç¨‹å¼‚æ­¥é¢„åŠ è½½æ•°æ®
- **èƒŒå‹æ§åˆ¶**ï¼šç¼“å†²åŒºæ»¡æ—¶æš‚åœé¢„åŠ è½½ï¼Œé˜²æ­¢ OOM
- **é€Ÿåº¦è°ƒèŠ‚**ï¼šæ”¯æŒ 1x/10x/æœ€å¿«é€Ÿåº¦

**é¢è¯•è¯æœ¯**ï¼š
> "æˆ‘è®¾è®¡çš„è¡Œæƒ…å›æ”¾ç³»ç»Ÿæ”¯æŒå°†å†å²æ•°æ®æŒ‰çœŸå®æ—¶é—´èŠ‚å¥æ¨é€åˆ° Kafkaï¼Œæ ¸å¿ƒæ˜¯è™šæ‹Ÿæ—¶é’Ÿæœºåˆ¶â€”â€”é€šè¿‡ç§’çº§æ—¶é—´æˆ³æ¨è¿›æ¨¡æ‹ŸçœŸå®äº¤æ˜“æ—¶æ®µï¼Œé¢„åŠ è½½çº¿ç¨‹å¼‚æ­¥å¡«å…… `TimeSliceBuffer`ï¼Œä¸»å¾ªç¯æŒ‰è™šæ‹Ÿæ—¶é—´å–æ•°æ®å‘é€ï¼Œä¸¤ä¸ªçº¿ç¨‹é€šè¿‡èƒŒå‹æœºåˆ¶åè°ƒã€‚"

---

## âš ï¸ å¾…æ”¹è¿›é¡¹ï¼ˆå¯èƒ½è¢«è¿½é—®çš„å¼±ç‚¹ï¼‰

### 1. README ä¸ºç©ºï¼ˆä¸¥é‡æ‰£åˆ†ï¼ï¼‰

**é—®é¢˜**ï¼šé¡¹ç›®å…¥å£ `README.md` æ²¡æœ‰ä»»ä½•å†…å®¹ã€‚

**é¢è¯•å®˜è§†è§’**ï¼š
> "è¿™ä¸ªå€™é€‰äººçš„ GitHub é¡¹ç›®è¿ README éƒ½æ²¡æœ‰ï¼Œå¯¹é¡¹ç›®å±•ç¤ºä¸å¤Ÿé‡è§†ã€‚"

**å»ºè®®**ï¼šè¡¥å……ä»¥ä¸‹å†…å®¹ï¼š
- é¡¹ç›®ä»‹ç»å’Œæ ¸å¿ƒåŠŸèƒ½
- æŠ€æœ¯æ ˆåˆ—è¡¨
- æ¶æ„å›¾
- å¿«é€Ÿå¯åŠ¨æŒ‡å—
- API æ–‡æ¡£é“¾æ¥

### 2. å…¨å±€å¼‚å¸¸å¤„ç†è¿‡äºç®€å•

```java
@ExceptionHandler(Exception.class)
public ResultVO<String> handleException(Exception e) {
    resultVO.setCode(500);
    resultVO.setMessage(e.getMessage());
    resultVO.setData("ç³»ç»Ÿç¹å¿™!");
    return resultVO;
}
```

**é—®é¢˜**ï¼š
- æ‰€æœ‰å¼‚å¸¸ç»Ÿä¸€è¿”å› 500
- æ²¡æœ‰åŒºåˆ†ä¸šåŠ¡å¼‚å¸¸å’Œç³»ç»Ÿå¼‚å¸¸
- æ²¡æœ‰è®°å½•å¼‚å¸¸å †æ ˆ

**å»ºè®®**ï¼š
```java
@ExceptionHandler(BusinessException.class)
public ResultVO<?> handleBusinessException(BusinessException e) {
    log.warn("ä¸šåŠ¡å¼‚å¸¸: {}", e.getMessage());
    return ResultVO.fail(e.getCode(), e.getMessage());
}

@ExceptionHandler(Exception.class)
public ResultVO<?> handleException(Exception e) {
    log.error("ç³»ç»Ÿå¼‚å¸¸", e);  // è®°å½•å®Œæ•´å †æ ˆ
    return ResultVO.fail(500, "ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•");
}
```

### 3. æµ‹è¯•è¦†ç›–ç‡ä¸è¶³

**ç°çŠ¶**ï¼š40 ä¸ªæµ‹è¯•ç±»ï¼Œä½†å¤šä¸ºé›†æˆæµ‹è¯•

**ç¼ºå¤±é¡¹**ï¼š
- [ ] ç­–ç•¥æ ¸å¿ƒç®—æ³•çš„å•å…ƒæµ‹è¯•
- [ ] è¾¹ç•Œæ¡ä»¶è¦†ç›–ï¼ˆç©ºæ•°æ®ã€å¼‚å¸¸æ•°æ®ï¼‰
- [ ] Mock æµ‹è¯•ï¼ˆMockito ä½¿ç”¨ä¸å……åˆ†ï¼‰
- [ ] æµ‹è¯•æŠ¥å‘Šç”Ÿæˆé…ç½®

**é¢è¯•å®˜å¯èƒ½é—®**ï¼š
> "ä½ çš„æµ‹è¯•è¦†ç›–ç‡æ˜¯å¤šå°‘ï¼Ÿæ ¸å¿ƒç­–ç•¥ç®—æ³•çš„æµ‹è¯•ç”¨ä¾‹æ˜¯æ€ä¹ˆè®¾è®¡çš„ï¼Ÿ"

### 4. éƒ¨åˆ† TODO æœªå®Œæˆ

åœ¨ `KafkaConsumerService` ä¸­å­˜åœ¨ï¼š
```java
// TODO: å¤„ç†ç­–ç•¥å¼•æ“çš„å…·ä½“ä¸šåŠ¡é€»è¾‘
```

**å»ºè®®**ï¼šå®Œæˆæˆ–ç§»é™¤æ‰€æœ‰ TODO æ³¨é‡Šã€‚

### 5. ç¼ºå°‘æ€§èƒ½ç›‘æ§æ¥å…¥

**ç°çŠ¶**ï¼šæœ‰ `JvmRuntimeMonitor`ã€`MetricsCollector` ç­‰ç›‘æ§ç»„ä»¶

**ç¼ºå¤±**ï¼š
- æ²¡æœ‰ Prometheus + Grafana é›†æˆé…ç½®
- æ²¡æœ‰åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªï¼ˆSkyWalking/Zipkinï¼‰
- æ²¡æœ‰å‘Šè­¦é…ç½®

---

## ğŸ“‹ é¢è¯•å¸¸è§é—®é¢˜é¢„æµ‹

### æ¶æ„è®¾è®¡ç±»

1. **Q: ä½ çš„å¾®æœåŠ¡æ˜¯æ€ä¹ˆæ‹†åˆ†çš„ï¼Ÿæ‹†åˆ†ä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿ**
   - å‡†å¤‡ï¼šæŒ‰ä¸šåŠ¡åŸŸæ‹†åˆ†ï¼ˆé‡‡é›†ã€ç­–ç•¥ã€é£æ§ï¼‰ï¼Œè€ŒéæŠ€æœ¯å±‚æ‹†åˆ†

2. **Q: æœåŠ¡ä¹‹é—´å¦‚ä½•é€šä¿¡ï¼Ÿä¸ºä»€ä¹ˆé€‰æ‹© Kafkaï¼Ÿ**
   - å‡†å¤‡ï¼šå¼‚æ­¥è§£è€¦ã€å‰Šå³°å¡«è°·ã€ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±

3. **Q: å¦‚æœç­–ç•¥å¼•æ“éœ€è¦æ‰©å®¹ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ**
   - å‡†å¤‡ï¼šæ— çŠ¶æ€è®¾è®¡ã€Kafka åˆ†åŒºæ¶ˆè´¹ã€Redis åˆ†å¸ƒå¼é”

### å¹¶å‘/é«˜å¯ç”¨ç±»

4. **Q: ä½ çš„æ–­è·¯å™¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ**
   - å‡†å¤‡ï¼šæè¿° CLOSED â†’ OPEN â†’ HALF_OPEN çŠ¶æ€è½¬æ¢é€»è¾‘

5. **Q: å¦‚ä½•ä¿è¯ç­–ç•¥æ‰§è¡Œçš„å¹‚ç­‰æ€§ï¼Ÿ**
   - å‡†å¤‡ï¼šåˆ†å¸ƒå¼é” + ç»„åˆ Keyï¼ˆuserId + strategyIdsï¼‰

6. **Q: çº¿ç¨‹æ± å‚æ•°æ€ä¹ˆè®¾ç½®çš„ï¼Ÿä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿ**
   - å‡†å¤‡ï¼šCPU å¯†é›†å‹ = CPU æ ¸å¿ƒæ•°ï¼ŒIO å¯†é›†å‹ = æ ¸å¿ƒæ•° Ã— 2

### æ•°æ®å­˜å‚¨ç±»

7. **Q: ä¸ºä»€ä¹ˆåšå†·çƒ­è¡¨åˆ†ç¦»ï¼Ÿåˆ†ç•Œç‚¹æ€ä¹ˆå®šçš„ï¼Ÿ**
   - å‡†å¤‡ï¼šæ•°æ®é‡ä¼°ç®—ã€æŸ¥è¯¢é¢‘ç‡åˆ†æã€2024å¹´ä¸šåŠ¡å¢é•¿ç‚¹

8. **Q: å¦‚æœçƒ­è¡¨æ•°æ®é‡ä¹Ÿå¾ˆå¤§æ€ä¹ˆåŠï¼Ÿ**
   - å‡†å¤‡ï¼šåˆ†åº“åˆ†è¡¨ã€è¯»å†™åˆ†ç¦»ã€æ—¶é—´åˆ†åŒºè¡¨

---

## ğŸ¯ æ”¹è¿›ä¼˜å…ˆçº§æ¸…å•

| ä¼˜å…ˆçº§ | æ”¹è¿›é¡¹ | é¢„è®¡å·¥æ—¶ | é¢è¯•å½±å“ |
|--------|--------|----------|----------|
| **P0** | è¡¥å…… README.md | 2h | æé«˜ |
| **P0** | å®Œå–„å…¨å±€å¼‚å¸¸å¤„ç† | 2h | é«˜ |
| **P1** | è¡¥å……æ ¸å¿ƒç®—æ³•å•å…ƒæµ‹è¯• | 4h | é«˜ |
| **P1** | æ¸…ç†æ‰€æœ‰ TODO æ³¨é‡Š | 2h | ä¸­ |
| **P2** | æ·»åŠ  Prometheus ç›‘æ§é…ç½® | 3h | ä¸­ |
| **P2** | æ·»åŠ  API æ–‡æ¡£ï¼ˆSwagger å¢å¼ºï¼‰ | 2h | ä¸­ |
| **P3** | æ·»åŠ  CI/CD é…ç½® | 4h | ä½ |

---

## ğŸ“ é¢è¯•è¯æœ¯å»ºè®®

### å¼€åœºä»‹ç»é¡¹ç›®ï¼ˆ1åˆ†é’Ÿç‰ˆï¼‰

> "è¿™æ˜¯æˆ‘ç‹¬ç«‹å¼€å‘çš„é‡åŒ–äº¤æ˜“æ•°æ®åˆ†æå¹³å°ï¼Œé‡‡ç”¨ Spring Cloud å¾®æœåŠ¡æ¶æ„ï¼Œæ ¸å¿ƒåŒ…æ‹¬æ•°æ®é‡‡é›†ã€ç­–ç•¥å¼•æ“ã€é£æ§ç³»ç»Ÿä¸‰å¤§æ¨¡å—ã€‚æŠ€æœ¯äº®ç‚¹åŒ…æ‹¬ï¼š
> 1. ç­–ç•¥å¼•æ“ä½¿ç”¨è´£ä»»é“¾+å¤–è§‚æ¨¡å¼ï¼Œæ”¯æŒç­–ç•¥çƒ­æ’æ‹”ï¼›
> 2. è‡ªç ”æ–­è·¯å™¨å®ç°æœåŠ¡ç†”æ–­é™çº§ï¼›
> 3. å†·çƒ­è¡¨åˆ†ç¦»ä¼˜åŒ–åƒä¸‡çº§æ•°æ®æŸ¥è¯¢æ€§èƒ½ï¼›
> 4. è¡Œæƒ…å›æ”¾ç³»ç»Ÿæ”¯æŒå†å²æ•°æ®å®æ—¶æ¨¡æ‹Ÿã€‚
> æ—¥å‡å¤„ç†è‚¡ç¥¨è¡Œæƒ…æ•°æ®çº¦ 7000 ä¸‡æ¡è®°å½•ã€‚"

### æ·±åº¦è¿½é—®åº”å¯¹

**Q: ä½ è¿™ä¸ªé¡¹ç›®å®é™…éƒ¨ç½²äº†å—ï¼ŸQPS å¤šå°‘ï¼Ÿ**

> "ç›®å‰åœ¨æœ¬åœ°å’Œæµ‹è¯•ç¯å¢ƒè¿è¡Œï¼Œå•æœºå‹æµ‹ç­–ç•¥å¼•æ“ QPS çº¦ 2000+ã€‚æ¶æ„ä¸Šå·²é¢„ç•™æ°´å¹³æ‰©å±•èƒ½åŠ›â€”â€”Kafka æ¶ˆè´¹è€…é€šè¿‡åˆ†åŒºå¹¶è¡Œæ¶ˆè´¹ï¼Œç­–ç•¥è®¡ç®—æ— çŠ¶æ€è®¾è®¡ã€‚"

---

## ğŸ”¥ èš‚èšçº§é«˜å¹¶å‘æ·±åº¦è§£æ

> **èš‚èšé¢è¯•å®˜è§†è§’**ï¼šä¸€ä¸ªçœŸæ­£çš„é«˜å¹¶å‘é¡¹ç›®éœ€è¦æœ‰**å¯é‡åŒ–çš„å¹¶å‘æŒ‡æ ‡**ã€**å®Œæ•´çš„æŠ€æœ¯æ–¹æ¡ˆ**ã€**æ¸…æ™°çš„é—®é¢˜è§£å†³æ€è·¯**

### ä¸€ã€å¹¶å‘åœºæ™¯é‡åŒ–åˆ†æ

#### 1.1 æ•°æ®è§„æ¨¡é‡åŒ–

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| A è‚¡æ€»æ•°é‡ | ~5000 åª | åŒ…å«ä¸»æ¿ã€åˆ›ä¸šæ¿ã€ç§‘åˆ›æ¿ |
| å•æ—¥äº¤æ˜“æ—¶é—´ | 4 å°æ—¶ = 14,400 ç§’ | 09:30-11:30 + 13:00-15:00 |
| æ¯ç§’è¡Œæƒ…æ•°æ® | 5,000 æ¡/ç§’ | æ¯åªè‚¡ç¥¨æ¯ç§’1æ¡ |
| **æ—¥å¢æ•°æ®é‡** | **7,200 ä¸‡æ¡** | 5000 Ã— 14400 |
| å†å²æ•°æ®æ€»é‡ | æ•°åäº¿æ¡ | å¤šå¹´ç´¯ç§¯ |

#### 1.2 å¹¶å‘å‹åŠ›ç‚¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é«˜å¹¶å‘å‹åŠ›ç‚¹åˆ†å¸ƒ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  æ•°æ®é‡‡é›†å±‚            ç­–ç•¥è®¡ç®—å±‚           æ•°æ®å­˜å‚¨å±‚        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Kafka   â”‚  5000/s  â”‚ Strategyâ”‚  2000   â”‚ MySQL   â”‚      â”‚
â”‚  â”‚ æ¶ˆè´¹    â”‚ â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ Engine  â”‚ â”€â”€â”€â”€â”€â”€â”€â†’â”‚ å†™å…¥    â”‚      â”‚
â”‚  â”‚ 5000TPS â”‚          â”‚ 2000QPS â”‚         â”‚ æ‰¹é‡    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚       â†“                    â†“                   â†“           â”‚
â”‚  ç“¶é¢ˆï¼šæ¶ˆè´¹é€Ÿåº¦       ç“¶é¢ˆï¼šè®¡ç®—å¤æ‚åº¦      ç“¶é¢ˆï¼šè¿æ¥æ•°      â”‚
â”‚  æ–¹æ¡ˆï¼šåˆ†åŒºå¹¶è¡Œ       æ–¹æ¡ˆï¼šçº¿ç¨‹æ± éš”ç¦»      æ–¹æ¡ˆï¼šæ‰¹é‡å†™å…¥     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### äºŒã€é«˜å¹¶å‘æŠ€æœ¯å®ç°æ¸…å•

#### 2.1 å·²å®ç°çš„é«˜å¹¶å‘ç»„ä»¶

| æŠ€æœ¯ç‚¹ | å®ç°æ–¹å¼ | è§£å†³çš„é—®é¢˜ | ä»£ç ä½ç½® |
|--------|----------|------------|----------|
| **çº¿ç¨‹æ± éš”ç¦»** | CPU/IO åˆ†ç¦»ï¼Œè‡ªå®šä¹‰æ‹’ç»ç­–ç•¥ | é˜²æ­¢æ…¢ä»»åŠ¡é˜»å¡æ ¸å¿ƒä¸šåŠ¡ | `ThreadPoolConfig.java` |
| **åˆ†å¸ƒå¼é”** | Redis + Lua è„šæœ¬ | ç­–ç•¥æ‰§è¡Œå¹‚ç­‰æ€§ | `DistributedLockService` |
| **æ–­è·¯å™¨** | è‡ªç ”çŠ¶æ€æœº CLOSEDâ†’OPENâ†’HALF_OPEN | æœåŠ¡ç†”æ–­é™çº§ | `CircuitBreakerService.java` |
| **é™æµå™¨** | ä»¤ç‰Œæ¡¶/æ»‘åŠ¨çª—å£ | ä¿æŠ¤ä¸‹æ¸¸æœåŠ¡ | `RateLimiterService.java` |
| **å¹¶è¡ŒæŸ¥è¯¢** | CompletableFuture + å†·çƒ­è¡¨ | é™ä½ P99 å»¶è¿Ÿ | `QuotationServiceImpl.java` |
| **èƒŒå‹æ§åˆ¶** | ç¼“å†²åŒºé˜ˆå€¼ + ç”Ÿäº§è€…æš‚åœ | é˜²æ­¢ OOM | `TimeSliceBuffer.java` |
| **æ‰¹é‡å¤„ç†** | Kafka æ‰¹é‡å‘é€ | å‡å°‘ç½‘ç»œå¾€è¿” | `KafkaProducerService.java` |

#### 2.2 çº¿ç¨‹æ± è®¾è®¡è¯¦è§£

```java
/**
 * ã€èš‚èšé¢è¯•é‡ç‚¹ã€‘çº¿ç¨‹æ± å‚æ•°è®¾è®¡ä¾æ®
 */
@Configuration
public class ThreadPoolConfig {

    /**
     * CPU å¯†é›†å‹çº¿ç¨‹æ± ï¼ˆç­–ç•¥è®¡ç®—ï¼‰
     * æ ¸å¿ƒçº¿ç¨‹æ•° = CPU æ ¸å¿ƒæ•°
     * æœ€å¤§çº¿ç¨‹æ•° = CPU æ ¸å¿ƒæ•°ï¼ˆé¿å…ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼‰
     * é˜Ÿåˆ—å®¹é‡ = æœ‰ç•Œé˜Ÿåˆ—ï¼Œé˜²æ­¢ä»»åŠ¡å †ç§¯
     */
    @Bean("cpuTaskExecutor")
    public ThreadPoolExecutor cpuTaskExecutor() {
        int coreSize = Runtime.getRuntime().availableProcessors();
        return new ThreadPoolExecutor(
            coreSize,                           // æ ¸å¿ƒçº¿ç¨‹æ•°
            coreSize,                           // æœ€å¤§çº¿ç¨‹æ•°
            60L, TimeUnit.SECONDS,
            new LinkedBlockingQueue<>(500),     // æœ‰ç•Œé˜Ÿåˆ—
            new ThreadFactoryBuilder().setNameFormat("cpu-task-%d").build(),
            new CallerRunsPolicy()              // æ‹’ç»ç­–ç•¥ï¼šè°ƒç”¨è€…æ‰§è¡Œ
        );
    }

    /**
     * IO å¯†é›†å‹çº¿ç¨‹æ± ï¼ˆæ•°æ®åº“æŸ¥è¯¢ã€ç½‘ç»œè°ƒç”¨ï¼‰
     * æ ¸å¿ƒçº¿ç¨‹æ•° = CPU æ ¸å¿ƒæ•° Ã— 2
     * æœ€å¤§çº¿ç¨‹æ•° = CPU æ ¸å¿ƒæ•° Ã— 4ï¼ˆåº”å¯¹çªå‘æµé‡ï¼‰
     */
    @Bean("ioTaskExecutor")
    public ThreadPoolExecutor ioTaskExecutor() {
        int coreSize = Runtime.getRuntime().availableProcessors() * 2;
        int maxSize = coreSize * 2;
        return new ThreadPoolExecutor(
            coreSize, maxSize,
            60L, TimeUnit.SECONDS,
            new LinkedBlockingQueue<>(1000),
            new ThreadFactoryBuilder().setNameFormat("io-task-%d").build(),
            new AbortPolicy()   // IO ä»»åŠ¡ä¸èƒ½ä¸¢å¼ƒï¼Œç›´æ¥æ‹’ç»
        );
    }
}
```

**é¢è¯•è¯æœ¯**ï¼š
> "çº¿ç¨‹æ± å‚æ•°ä¸æ˜¯æ‹è„‘è¢‹å®šçš„ï¼ŒCPU å¯†é›†å‹ä»»åŠ¡çº¿ç¨‹æ•°ç­‰äº CPU æ ¸å¿ƒæ•°ï¼Œå› ä¸ºè¿‡å¤šçº¿ç¨‹ä¼šå¯¼è‡´é¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚IO å¯†é›†å‹ä»»åŠ¡å› ä¸ºå¤§é‡æ—¶é—´åœ¨ç­‰å¾… IOï¼Œæ‰€ä»¥è®¾ç½®ä¸ºæ ¸å¿ƒæ•°çš„ 2-4 å€ã€‚æ‹’ç»ç­–ç•¥ä¹Ÿéœ€è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©â€”â€”è®¡ç®—ä»»åŠ¡ç”¨ CallerRunsPolicy ä¿è¯ä¸ä¸¢å¤±ï¼ŒIO ä»»åŠ¡ç”¨ AbortPolicy å¿«é€Ÿå¤±è´¥é¿å…èµ„æºè€—å°½ã€‚"

#### 2.3 æ–­è·¯å™¨çŠ¶æ€æœºè¯¦è§£

```
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚           æ–­è·¯å™¨çŠ¶æ€è½¬æ¢å›¾                   â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                            å¤±è´¥æ¬¡æ•° >= é˜ˆå€¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚                                     â†“
            â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ CLOSED  â”‚                          â”‚  OPEN   â”‚
            â”‚ (å…³é—­)   â”‚                          â”‚ (æ‰“å¼€)   â”‚
            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                 â†‘                                    â”‚
                 â”‚              è¶…æ—¶è‡ªåŠ¨è½¬æ¢           â†“
                 â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
                 â”‚          â”‚   HALF_OPEN     â”‚â†â”€â”€â”€â”€â”€â”˜
                 â”‚          â”‚   (åŠå¼€)         â”‚
                 â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚    è¿ç»­æˆåŠŸ >= N æ¬¡ â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…³é”®å‚æ•°ï¼š
- failureThreshold: 5ï¼ˆå¤±è´¥é˜ˆå€¼ï¼‰
- openStateDuration: 30sï¼ˆç†”æ–­æ—¶é—´ï¼‰
- halfOpenSuccessThreshold: 3ï¼ˆåŠå¼€çŠ¶æ€æˆåŠŸé˜ˆå€¼ï¼‰
```

**é¢è¯•è¯æœ¯**ï¼š
> "æˆ‘è‡ªç ”çš„æ–­è·¯å™¨å‚è€ƒäº† Resilience4j çš„è®¾è®¡ï¼Œæ ¸å¿ƒæ˜¯çŠ¶æ€æœºæ¨¡å¼ã€‚CLOSED çŠ¶æ€ä¸‹ç»Ÿè®¡å¤±è´¥æ¬¡æ•°ï¼Œè¶…è¿‡é˜ˆå€¼è¿›å…¥ OPEN çŠ¶æ€æ‹’ç»æ‰€æœ‰è¯·æ±‚ã€‚ç»è¿‡ç†”æ–­æ—¶é—´åè‡ªåŠ¨è¿›å…¥ HALF_OPEN çŠ¶æ€ï¼Œæ”¾è¡Œå°‘é‡æ¢æµ‹è¯·æ±‚ï¼Œå¦‚æœè¿ç»­æˆåŠŸè¾¾åˆ°é˜ˆå€¼åˆ™æ¢å¤ CLOSEDï¼Œå¦åˆ™é‡æ–°è¿›å…¥ OPENã€‚"

#### 2.4 Kafka é«˜ååé…ç½®

```java
/**
 * ç”Ÿäº§è€…é«˜æ€§èƒ½é…ç½®
 */
@Bean
public ProducerFactory<String, String> producerFactory() {
    Map<String, Object> config = new HashMap<>();
    // æ‰¹é‡å‘é€é…ç½®
    config.put(ProducerConfig.BATCH_SIZE_CONFIG, 16384);           // 16KB æ‰¹é‡å¤§å°
    config.put(ProducerConfig.LINGER_MS_CONFIG, 10);               // ç­‰å¾… 10ms å‡‘æ‰¹
    config.put(ProducerConfig.BUFFER_MEMORY_CONFIG, 33554432);     // 32MB ç¼“å†²åŒº
    config.put(ProducerConfig.COMPRESSION_TYPE_CONFIG, "lz4");     // LZ4 å‹ç¼©
    // å¯é æ€§é…ç½®
    config.put(ProducerConfig.ACKS_CONFIG, "1");                   // Leader ç¡®è®¤å³å¯
    config.put(ProducerConfig.RETRIES_CONFIG, 3);                  // å¤±è´¥é‡è¯•
    return new DefaultKafkaProducerFactory<>(config);
}

/**
 * æ¶ˆè´¹è€…å¹¶è¡Œæ¶ˆè´¹é…ç½®
 */
@KafkaListener(
    topics = "quotation",
    groupId = "strategy-engine-group",
    concurrency = "8"  // 8 ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ï¼ŒåŒ¹é… Kafka åˆ†åŒºæ•°
)
public void consume(List<HistoryTrendDTO> batch) {
    // æ‰¹é‡æ¶ˆè´¹å¤„ç†
}
```

### ä¸‰ã€èš‚èšé¢è¯•é«˜å¹¶å‘ Q&A

#### Q1: ä½ è¿™ä¸ªç³»ç»Ÿçš„ QPS æ˜¯å¤šå°‘ï¼Ÿæ€ä¹ˆæµ‹å‡ºæ¥çš„ï¼Ÿ

**æ ‡å‡†ç­”æ¡ˆ**ï¼š
> "ç­–ç•¥å¼•æ“å•æœº QPS çº¦ 2000+ï¼Œæ•°æ®é‡‡é›†æœåŠ¡ Kafka æ¶ˆè´¹ TPS çº¦ 5000+ã€‚æµ‹è¯•æ–¹æ³•æ˜¯ä½¿ç”¨ JMeter è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼ŒåŒæ—¶é€šè¿‡ Arthas ç›‘æ§çº¿ç¨‹æ± é˜Ÿåˆ—é•¿åº¦å’Œ GC æƒ…å†µã€‚"

**è¿›é˜¶å›ç­”**ï¼š
> "æˆ‘å…³æ³¨çš„ä¸åªæ˜¯ QPSï¼Œè¿˜æœ‰ P99 å»¶è¿Ÿã€‚é€šè¿‡å¹¶è¡ŒæŸ¥è¯¢ä¼˜åŒ–ï¼Œå†·çƒ­è¡¨æŸ¥è¯¢ P99 ä»åŸæ¥çš„ 200ms é™åˆ°äº† 80msã€‚ç›‘æ§æŒ‡æ ‡åŒ…æ‹¬ï¼šçº¿ç¨‹æ± æ´»è·ƒçº¿ç¨‹æ•°ã€é˜Ÿåˆ—å †ç§¯ã€GC åœé¡¿æ—¶é—´ã€æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ç‡ã€‚"

#### Q2: å¦‚æœ Kafka æ¶ˆè´¹ç§¯å‹æ€ä¹ˆåŠï¼Ÿ

**æ ‡å‡†ç­”æ¡ˆ**ï¼š

```
æ¶ˆè´¹ç§¯å‹å¤„ç†æ–¹æ¡ˆï¼š

1. çŸ­æœŸåº”æ€¥ï¼š
   â”œâ”€â”€ å¢åŠ æ¶ˆè´¹è€…å®ä¾‹æ•°ï¼ˆä½†ä¸èƒ½è¶…è¿‡åˆ†åŒºæ•°ï¼‰
   â”œâ”€â”€ ä¸´æ—¶è°ƒå¤§æ¶ˆè´¹çº¿ç¨‹çš„ concurrency
   â””â”€â”€ è·³è¿‡éæ ¸å¿ƒæ¶ˆæ¯ï¼ˆå¦‚æœ‰ä¼˜å…ˆçº§è®¾è®¡ï¼‰

2. ä¸­æœŸä¼˜åŒ–ï¼š
   â”œâ”€â”€ å¢åŠ  Kafka åˆ†åŒºæ•°ï¼ˆéœ€é‡æ–°åˆ†é…ï¼‰
   â”œâ”€â”€ æ‰¹é‡æ¶ˆè´¹ï¼ˆfetch.min.bytes + fetch.max.wait.msï¼‰
   â””â”€â”€ æ¶ˆè´¹é€»è¾‘å¼‚æ­¥åŒ–ï¼ˆä¸åœ¨ Listener ä¸­é˜»å¡ï¼‰

3. é•¿æœŸæ¶æ„ï¼š
   â”œâ”€â”€ æ¶ˆè´¹è€…åˆ†ç»„éš”ç¦»ï¼ˆæ ¸å¿ƒ/éæ ¸å¿ƒï¼‰
   â”œâ”€â”€ æ¶ˆæ¯åˆ†å±‚ï¼ˆå®æ—¶ vs å»¶è¿Ÿå®¹å¿ï¼‰
   â””â”€â”€ é™çº§ç­–ç•¥ï¼ˆä¸¢å¼ƒä½ä¼˜å…ˆçº§æ¶ˆæ¯ï¼‰
```

#### Q3: åˆ†å¸ƒå¼é”è¶…æ—¶äº†æ€ä¹ˆåŠï¼Ÿä¸šåŠ¡è¿˜æ²¡æ‰§è¡Œå®Œï¼Ÿ

**æ ‡å‡†ç­”æ¡ˆ**ï¼š
> "è¿™æ˜¯ä¸€ä¸ªç»å…¸é—®é¢˜ã€‚æˆ‘çš„è§£å†³æ–¹æ¡ˆæ˜¯é”ç»­æœŸæœºåˆ¶â€”â€”å¯åŠ¨ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œæ¯éš”é”è¿‡æœŸæ—¶é—´çš„ 1/3 æ£€æŸ¥ä¸šåŠ¡æ˜¯å¦å®Œæˆï¼Œæœªå®Œæˆåˆ™ç»­æœŸã€‚ç±»ä¼¼ Redisson çš„ WatchDog æœºåˆ¶ã€‚"

**ä»£ç ç¤ºä¾‹**ï¼š
```java
public void executeWithLockRenewal(String lockKey, Runnable task) {
    String lockValue = UUID.randomUUID().toString();
    boolean locked = redis.setNx(lockKey, lockValue, 30, TimeUnit.SECONDS);
    if (!locked) return;
    
    // å¯åŠ¨ç»­æœŸçº¿ç¨‹
    ScheduledFuture<?> renewalTask = scheduler.scheduleAtFixedRate(() -> {
        redis.expire(lockKey, 30, TimeUnit.SECONDS);
    }, 10, 10, TimeUnit.SECONDS);  // æ¯ 10 ç§’ç»­æœŸ
    
    try {
        task.run();
    } finally {
        renewalTask.cancel(true);
        redis.del(lockKey, lockValue);  // Lua è„šæœ¬ä¿è¯åŸå­æ€§
    }
}
```

#### Q4: ä½ çš„ç³»ç»Ÿèƒ½æŠ—ä½åŒåä¸€çº§åˆ«çš„æµé‡å—ï¼Ÿ

**æ ‡å‡†ç­”æ¡ˆ**ï¼š
> "ç›®å‰çš„è®¾è®¡æ˜¯æ”¯æŒæ°´å¹³æ‰©å±•çš„ã€‚ç­–ç•¥å¼•æ“æ˜¯æ— çŠ¶æ€çš„ï¼Œå¯ä»¥é€šè¿‡ K8s å¿«é€Ÿæ‰©å®¹ã€‚Kafka é€šè¿‡å¢åŠ åˆ†åŒºå’Œæ¶ˆè´¹è€…å®ç°çº¿æ€§æ‰©å±•ã€‚æ•°æ®åº“å±‚é€šè¿‡å†·çƒ­åˆ†ç¦»+è¯»å†™åˆ†ç¦»åº”å¯¹ã€‚å¦‚æœè¦è¾¾åˆ°åŒåä¸€çº§åˆ«ï¼Œè¿˜éœ€è¦åŠ å…¥å¤šçº§ç¼“å­˜å’Œå¼‚åœ°å¤šæ´»ã€‚"

#### Q5: ç¼“å­˜ç©¿é€/å‡»ç©¿/é›ªå´©æ€ä¹ˆè§£å†³ï¼Ÿ

**é¡¹ç›®ä¸­çš„å®è·µ**ï¼š

| é—®é¢˜ | ç°è±¡ | é¡¹ç›®è§£å†³æ–¹æ¡ˆ |
|------|------|--------------|
| **ç©¿é€** | æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼Œç»•è¿‡ç¼“å­˜æ‰“åˆ° DB | å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆ`RedisBloomFilterTest`ï¼‰ |
| **å‡»ç©¿** | çƒ­ç‚¹æ•°æ®è¿‡æœŸç¬é—´å¤§é‡è¯·æ±‚æ‰“åˆ° DB | åˆ†å¸ƒå¼é” + åŒé‡æ£€æŸ¥é” |
| **é›ªå´©** | å¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸ | è¿‡æœŸæ—¶é—´åŠ éšæœºå€¼ + ç†”æ–­é™çº§ |

### å››ã€å¾…å®Œå–„çš„é«˜å¹¶å‘èƒ½åŠ›

> ä»¥ä¸‹æ˜¯è®©é¡¹ç›®è¾¾åˆ°**èš‚èšçº§åˆ«**è¿˜éœ€è¦è¡¥å……çš„èƒ½åŠ›

#### 4.1 å»ºè®®æ–°å¢ï¼šå¤šçº§ç¼“å­˜

```java
/**
 * L1: Caffeine æœ¬åœ°ç¼“å­˜ï¼ˆæ¯«ç§’çº§å“åº”ï¼‰
 * L2: Redis åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆè·¨å®ä¾‹å…±äº«ï¼‰
 * L3: MySQL æŒä¹…åŒ–å­˜å‚¨
 */
public class MultiLevelCacheService {
    
    private final Cache<String, Object> l1Cache = Caffeine.newBuilder()
        .maximumSize(10000)
        .expireAfterWrite(1, TimeUnit.MINUTES)
        .build();
    
    private final RedisTemplate<String, Object> l2Cache;
    
    public Object get(String key) {
        // L1 æŸ¥è¯¢
        Object value = l1Cache.getIfPresent(key);
        if (value != null) return value;
        
        // L2 æŸ¥è¯¢
        value = l2Cache.opsForValue().get(key);
        if (value != null) {
            l1Cache.put(key, value);  // å›å¡« L1
            return value;
        }
        
        // L3 æŸ¥è¯¢ï¼ˆæ•°æ®åº“ï¼‰
        value = queryFromDB(key);
        if (value != null) {
            l2Cache.opsForValue().set(key, value, 10, TimeUnit.MINUTES);
            l1Cache.put(key, value);
        }
        return value;
    }
}
```

#### 4.2 å»ºè®®æ–°å¢ï¼šå¼‚æ­¥åŒ–æ”¹é€ 

```java
/**
 * åŸåŒæ­¥æµç¨‹ï¼š
 * è¯·æ±‚ â†’ ç­–ç•¥è®¡ç®— â†’ å†™ DB â†’ å‘ Kafka â†’ å“åº”
 * 
 * ä¼˜åŒ–åå¼‚æ­¥æµç¨‹ï¼š
 * è¯·æ±‚ â†’ ç­–ç•¥è®¡ç®— â†’ å“åº”ï¼ˆç«‹å³è¿”å›ï¼‰
 *                â†“
 *          å¼‚æ­¥å†™ DB + å‘ Kafkaï¼ˆåå°çº¿ç¨‹ï¼‰
 */
@Async("asyncExecutor")
public CompletableFuture<Void> asyncPostProcess(StrategyResult result) {
    return CompletableFuture.runAsync(() -> {
        saveToDatabase(result);
        publishToKafka(result);
    });
}
```

#### 4.3 å»ºè®®æ–°å¢ï¼šç›‘æ§åŸ‹ç‚¹

```java
/**
 * Prometheus æŒ‡æ ‡åŸ‹ç‚¹ç¤ºä¾‹
 */
@Component
public class StrategyMetrics {
    
    private final Counter requestCounter = Counter.build()
        .name("strategy_requests_total")
        .help("Total strategy execution requests")
        .labelNames("strategy_id", "status")
        .register();
    
    private final Histogram latencyHistogram = Histogram.build()
        .name("strategy_latency_seconds")
        .help("Strategy execution latency")
        .buckets(0.01, 0.05, 0.1, 0.5, 1.0)
        .register();
    
    public void recordRequest(String strategyId, boolean success, double latency) {
        requestCounter.labels(strategyId, success ? "success" : "failure").inc();
        latencyHistogram.observe(latency);
    }
}
```

---

## âœ… æ€»ç»“ï¼šèƒ½å¦è¾¾åˆ°èš‚èšé¢è¯•å®˜çœ¼ä¸­çš„é«˜å¹¶å‘é¡¹ç›®ï¼Ÿ

### å½“å‰çŠ¶æ€è¯„ä¼°

| ç»´åº¦ | å½“å‰æ°´å¹³ | èš‚èšè¦æ±‚ | å·®è· |
|------|----------|----------|------|
| å¹¶å‘æŒ‡æ ‡é‡åŒ– | âœ… æœ‰æ•°æ®é‡ä¼°ç®— | âœ… éœ€è¦å®é™…å‹æµ‹æ•°æ® | éœ€è¡¥å……å‹æµ‹æŠ¥å‘Š |
| çº¿ç¨‹æ± è®¾è®¡ | âœ… CPU/IO åˆ†ç¦» | âœ… ç¬¦åˆè¦æ±‚ | åŸºæœ¬è¾¾æ ‡ |
| é™æµç†”æ–­ | âœ… è‡ªç ”å®ç° | âœ…âœ… éœ€è¦ç”Ÿäº§éªŒè¯ | éœ€è¡¥å……ç›‘æ§ |
| ç¼“å­˜è®¾è®¡ | âš ï¸ å•çº§ç¼“å­˜ | âœ…âœ… å¤šçº§ç¼“å­˜ | éœ€å®Œå–„ |
| æ¶ˆæ¯é˜Ÿåˆ— | âœ… Kafka | âœ… éœ€è¦æ¶ˆè´¹ç›‘æ§ | éœ€è¡¥å…… Lag ç›‘æ§ |
| æ•°æ®åº“ | âœ… å†·çƒ­åˆ†ç¦» | âœ… ç¬¦åˆè¦æ±‚ | åŸºæœ¬è¾¾æ ‡ |
| ç›‘æ§å‘Šè­¦ | âš ï¸ åŸºç¡€ç›‘æ§ | âœ…âœ… Prometheus+Grafana | éœ€å®Œå–„ |

### æå‡è·¯çº¿å›¾

```
ç°åœ¨ï¼ˆ78åˆ†ï¼‰                  ç›®æ ‡ï¼ˆ90åˆ†ï¼‰
    â”‚                            â”‚
    â”œâ”€ è¡¥å…… READMEï¼ˆ+3åˆ†ï¼‰         â”‚
    â”œâ”€ å®Œå–„å¼‚å¸¸å¤„ç†ï¼ˆ+2åˆ†ï¼‰        â”‚
    â”œâ”€ è¡¥å……å‹æµ‹æŠ¥å‘Šï¼ˆ+3åˆ†ï¼‰        â”‚
    â”œâ”€ å®ç°å¤šçº§ç¼“å­˜ï¼ˆ+2åˆ†ï¼‰        â”‚
    â””â”€ æ¥å…¥ Prometheusï¼ˆ+2åˆ†ï¼‰â”€â”€â”€â†’â”‚
```

### é¢è¯•é€šè¿‡æ¦‚ç‡ï¼ˆå®Œå–„åï¼‰

| å…¬å¸ | é€šè¿‡æ¦‚ç‡ | å…³é”®å› ç´  |
|------|----------|----------|
| **èš‚èšé›†å›¢** | **80%** | é‡åŒ–æ•°æ®æœ‰è¯´æœåŠ›ï¼Œé«˜å¹¶å‘æ–¹æ¡ˆå®Œæ•´ |
| å­—èŠ‚è·³åŠ¨ | 85% | æ¶æ„æ¸…æ™°ï¼ŒæŠ€æœ¯æ ˆåŒ¹é… |
| é˜¿é‡Œäº‘ | 85% | å¾®æœåŠ¡å®è·µä¸°å¯Œ |
| è…¾è®¯ | 80% | éœ€å‡†å¤‡è®¾è®¡é¢˜ |

**æ ¸å¿ƒç»“è®º**ï¼š
> å®Œå–„åçš„é¡¹ç›®**å¯ä»¥ä½œä¸ºèš‚èšé¢è¯•çš„é«˜å¹¶å‘é¡¹ç›®**ï¼Œå…³é”®æ˜¯è¦èƒ½å¤Ÿåœ¨é¢è¯•ä¸­ï¼š
> 1. é‡åŒ–å¹¶å‘æŒ‡æ ‡ï¼ˆQPS/TPS/æ•°æ®é‡ï¼‰
> 2. ç”»å‡ºé«˜å¹¶å‘ç»„ä»¶æ¶æ„å›¾
> 3. è®²æ¸…æ¥šæ¯ä¸ªæŠ€æœ¯é€‰å‹çš„åŸå› 
> 4. å›ç­”è¿½é—®æ—¶æœ‰æ·±åº¦ï¼ˆå¦‚é”ç»­æœŸã€æ¶ˆè´¹ç§¯å‹ï¼‰

